#include "main.h"
#include "drivetrain.hpp"

using namespace control;

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */

/**
 *
 */
Drivetrain::Drivetrain(void) :
engine(pwm),
servo(pwm)
{
  return;
}

/**
 *
 */
void Drivetrain::start(void) {

  pwm.start();
  engine.start();
  servo.start();

  ready = true;
}

/**
 *
 */
void Drivetrain::stop(void) {
  ready = false;

  servo.stop();
  engine.stop();
  pwm.stop();
}

/**
 *
 */
msg_t Drivetrain::update(const DrivetrainImpact &impact) {

  osalDbgCheck(ready);

  servo.update(impact);
  engine.update(impact);

  return MSG_OK;
}

/**
 *
 */
uint32_t Drivetrain::capabilities(void) {
  uint32_t ret = 0;

  ret |= (1 << IMPACT_THR) | (1 << IMPACT_RUD);

  return ret;
}




