#include "main.h"
#include "fpga_pwm.h"

#include "pwm_fpga.hpp"

using namespace control;

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */
/**
 *
 */
PWMFPGA::PWMFPGA(void) {
  return;
}

/**
 *
 */
void PWMFPGA::start(void) {

  if (ready)
    return;

  fpgaPwmStart(&FPGAPWMD1, &FPGAD1);

  ready = true;
}

/**
 *
 */
void PWMFPGA::stop(void) {

  if (!ready)
    return;

  ready = false;

  fpgaPwmStop(&FPGAPWMD1);
}

/**
 *
 */
void PWMFPGA::update(uint16_t pwm, size_t channel) {

//  FPGAPWMD1.pwm[0] = 1450;
//  FPGAPWMD1.pwm[1] = 1475;
//  FPGAPWMD1.pwm[2] = 1525;
//  FPGAPWMD1.pwm[3] = 1550;

  FPGAPWMD1.pwm[channel] = pwm;
}
